<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agent Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--accent:#F5A623;--bg:#FAFAF8;--card:#FFFFFF;--border:#E8E8E8;--header:#111827;--text:#374151;--muted:#9CA3AF;--radius:14px}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
a{color:inherit;text-decoration:none}

/* Header */
.header{background:var(--header);color:#fff;padding:16px 24px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:100}
.header h1{font-size:20px;font-weight:700;flex:1}
.agent-select{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.2);padding:8px 12px;border-radius:8px;font-family:inherit;font-size:14px;cursor:pointer}
.agent-select option{color:#111;background:#fff}
.agent-badge{display:inline-flex;align-items:center;gap:6px;background:var(--accent);color:#fff;padding:4px 12px;border-radius:20px;font-size:13px;font-weight:600}
.agent-status{width:8px;height:8px;border-radius:50%;background:#22c55e;display:inline-block}

/* Layout */
.container{max-width:1200px;margin:0 auto;padding:24px}
.section{margin-bottom:32px}
.section-title{font-size:16px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}

/* Filter Tabs */
.filter-tabs{display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap}
.filter-tab{padding:6px 14px;border-radius:20px;font-size:13px;font-weight:500;cursor:pointer;border:1px solid var(--border);background:var(--card);transition:.2s}
.filter-tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}

/* Cards */
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:.2s}
.card:hover{box-shadow:0 4px 12px rgba(0,0,0,.06);transform:translateY(-1px)}
.card-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.card-icon{font-size:20px}
.card-title{font-weight:600;font-size:14px;flex:1}
.status-badge{padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase}
.status-done{background:#dcfce7;color:#166534}
.status-ongoing{background:#dbeafe;color:#1e40af}
.status-active{background:#fef3c7;color:#92400e}
.status-backlog{background:#f3f4f6;color:#6b7280}
.status-blocked{background:#fee2e2;color:#991b1b}
.progress-bar{height:6px;background:#f3f4f6;border-radius:3px;margin:10px 0;overflow:hidden}
.progress-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .4s}
.card-meta{display:flex;gap:14px;font-size:12px;color:var(--muted);margin-top:8px}
.card-detail{display:none;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);font-size:13px;line-height:1.6;color:var(--muted)}
.card.expanded .card-detail{display:block}

/* Pills */
.pills{display:flex;flex-wrap:wrap;gap:8px}
.pill{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:var(--card);border:1px solid var(--border);border-radius:20px;font-size:13px}
.pill-freq{color:var(--muted);font-size:11px}

/* Knowledge Grid */
.kb-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
.kb-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);font-size:13px}
.kb-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.kb-learned{background:#22c55e}
.kb-partial{background:#eab308}
.kb-missing{background:#ef4444}

/* Timeline */
.timeline{display:flex;flex-direction:column;gap:0}
.tl-item{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);font-size:13px}
.tl-icon{font-size:18px;flex-shrink:0}
.tl-date{color:var(--muted);font-size:11px;min-width:110px;flex-shrink:0}
.tl-text{flex:1}

/* File Explorer */
.file-search{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:var(--radius);font-family:inherit;font-size:13px;margin-bottom:12px;background:var(--card)}
.file-tree{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:8px;font-size:13px;font-family:'SF Mono','Menlo',monospace}
.ft-folder,.ft-file{padding:4px 8px;cursor:pointer;border-radius:6px;display:flex;align-items:center;gap:6px}
.ft-folder:hover,.ft-file:hover{background:#f3f4f6}
.ft-children{padding-left:20px;display:none}
.ft-folder.open>.ft-children{display:block}
.ft-size{color:var(--muted);margin-left:auto;font-size:11px}
.ft-arrow{transition:transform .2s;display:inline-block;font-size:10px}
.ft-folder.open>.ft-arrow{transform:rotate(90deg)}

/* Slide Panel */
.slide-panel{position:fixed;top:0;right:-400px;width:400px;max-width:90vw;height:100vh;background:var(--card);box-shadow:-4px 0 20px rgba(0,0,0,.1);z-index:200;transition:right .3s;padding:24px;overflow-y:auto}
.slide-panel.open{right:0}
.slide-close{position:absolute;top:16px;right:16px;background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted)}
.slide-title{font-weight:600;font-size:16px;margin-bottom:16px;padding-right:40px}
.slide-body{color:var(--muted);font-size:14px}

/* Footer */
.footer{text-align:center;padding:24px;font-size:12px;color:var(--muted)}

/* Loading */
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:16px;color:var(--muted)}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Responsive */
@media(max-width:640px){
  .card-grid{grid-template-columns:1fr}
  .header{padding:12px 16px}
  .container{padding:16px}
  .header h1{font-size:16px}
}
</style>
</head>
<body>
<div class="header">
  <select class="agent-select" id="agentSelect"></select>
  <h1 id="headerTitle">Agent Dashboard</h1>
  <span class="agent-badge" id="agentBadge"></span>
</div>
<div class="container" id="app">
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div>Dashboard wird geladen...</div>
  </div>
</div>
<div class="footer" id="footer"></div>
<div class="slide-panel" id="slidePanel">
  <button class="slide-close" onclick="document.getElementById('slidePanel').classList.remove('open')">&times;</button>
  <div class="slide-title" id="slideTitle"></div>
  <div class="slide-body" id="slideBody">Dateiinhalt wird geladen...</div>
</div>

<script>
let DATA=null, currentAgent=null;

async function init(){
  try{
    const r=await fetch('./data.json');
    if(!r.ok)throw new Error();
    DATA=await r.json();
  }catch(e){
    document.getElementById('loading').innerHTML='<div>Dashboard wird geladen... Bitte data.json bereitstellen</div>';
    return;
  }
  buildSelect();
  const hash=location.hash.replace('#','');
  const agent=DATA.agents.find(a=>a.id===hash)||DATA.agents[0];
  if(agent)selectAgent(agent.id);
}

function buildSelect(){
  const sel=document.getElementById('agentSelect');
  sel.innerHTML=DATA.agents.map(a=>`<option value="${a.id}">${a.emoji} ${a.name}</option>`).join('');
  sel.onchange=()=>{selectAgent(sel.value);location.hash=sel.value};
}

function selectAgent(id){
  currentAgent=DATA.agents.find(a=>a.id===id);
  if(!currentAgent)return;
  document.getElementById('agentSelect').value=id;
  document.documentElement.style.setProperty('--accent',currentAgent.color);
  document.getElementById('headerTitle').textContent=currentAgent.emoji+' '+currentAgent.name+' Dashboard';
  document.getElementById('agentBadge').innerHTML=`<span class="agent-status"></span>${currentAgent.role}`;
  location.hash=id;
  render();
}

function render(){
  const a=currentAgent;
  const app=document.getElementById('app');
  app.innerHTML=`
    <div class="section">
      <div class="section-title">ğŸ“‹ Projekt-Board</div>
      <div class="filter-tabs" id="filterTabs"></div>
      <div class="card-grid" id="projectGrid"></div>
    </div>
    <div class="section">
      <div class="section-title">ğŸ”„ Wiederkehrende Aufgaben</div>
      <div class="pills" id="taskPills"></div>
    </div>
    <div class="section">
      <div class="section-title">ğŸ§  Knowledge Base</div>
      <div class="kb-grid" id="kbGrid"></div>
    </div>
    <div class="section">
      <div class="section-title">ğŸ“… Activity Timeline</div>
      <div class="timeline" id="timeline"></div>
    </div>
    <div class="section">
      <div class="section-title">ğŸ“ File Explorer</div>
      <input class="file-search" id="fileSearch" placeholder="Dateien suchen...">
      <div class="file-tree" id="fileTree"></div>
    </div>`;
  renderFilters();
  renderProjects('all');
  renderTasks();
  renderKB();
  renderTimeline();
  renderFiles();
  document.getElementById('footer').textContent='Zuletzt aktualisiert: '+new Date(DATA.lastUpdated).toLocaleString('de-DE');
}

function renderFilters(){
  const tabs=['all','backlog','active','ongoing','done','blocked'];
  const labels={all:'Alle',backlog:'Backlog',active:'In Progress',ongoing:'Ongoing',done:'Done',blocked:'Blocked'};
  document.getElementById('filterTabs').innerHTML=tabs.map(t=>
    `<div class="filter-tab${t==='all'?' active':''}" data-f="${t}">${labels[t]}</div>`
  ).join('');
  document.getElementById('filterTabs').onclick=e=>{
    const t=e.target.closest('.filter-tab');if(!t)return;
    document.querySelectorAll('.filter-tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    renderProjects(t.dataset.f);
  };
}

function renderProjects(filter){
  const projects=(currentAgent.projects||[]).filter(p=>filter==='all'||p.status===filter);
  document.getElementById('projectGrid').innerHTML=projects.length?projects.map(p=>`
    <div class="card" onclick="this.classList.toggle('expanded')">
      <div class="card-header">
        <span class="card-icon">${p.icon||'ğŸ“„'}</span>
        <span class="card-title">${p.title}</span>
        <span class="status-badge status-${p.status}">${{done:'Done',ongoing:'Ongoing',active:'In Progress',backlog:'Backlog',blocked:'Blocked'}[p.status]||p.status}</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${p.pct||0}%"></div></div>
      <div class="card-meta">
        <span>ğŸ“ ${p.files||0} Files</span>
        <span>â­ ${p.next||'â€”'}</span>
        <span>ğŸ“… ${p.date||''}</span>
      </div>
      <div class="card-detail">${p.detail||'Keine Details verfÃ¼gbar.'}</div>
    </div>`).join(''):'<div style="color:var(--muted);font-size:13px">Keine Projekte in diesem Filter.</div>';
}

function renderTasks(){
  document.getElementById('taskPills').innerHTML=(currentAgent.tasks||[]).map(t=>
    `<div class="pill">${t.icon||'âš¡'} ${t.name} <span class="pill-freq">${t.freq||''}</span></div>`
  ).join('')||'<span style="color:var(--muted);font-size:13px">Keine Aufgaben definiert.</span>';
}

function renderKB(){
  const sm={learned:'kb-learned',partial:'kb-partial',missing:'kb-missing'};
  document.getElementById('kbGrid').innerHTML=(currentAgent.knowledge||[]).map(k=>
    `<div class="kb-item"><span class="kb-dot ${sm[k.status]||'kb-missing'}"></span>${k.name}</div>`
  ).join('')||'<span style="color:var(--muted);font-size:13px">Keine Knowledge-EintrÃ¤ge.</span>';
}

function renderTimeline(){
  document.getElementById('timeline').innerHTML=(currentAgent.timeline||[]).map(t=>
    `<div class="tl-item"><span class="tl-icon">${t.icon||'ğŸ“Œ'}</span><span class="tl-date">${t.date}</span><span class="tl-text">${t.text}</span></div>`
  ).join('')||'<span style="color:var(--muted);font-size:13px">Keine AktivitÃ¤ten.</span>';
}

function renderFiles(){
  const tree=currentAgent.files;
  if(!tree){document.getElementById('fileTree').innerHTML='<span style="color:var(--muted)">Kein Dateibaum verfÃ¼gbar.</span>';return}
  document.getElementById('fileTree').innerHTML=renderNode(tree);
  document.getElementById('fileSearch').oninput=e=>{
    const q=e.target.value.toLowerCase();
    document.querySelectorAll('.ft-file,.ft-folder').forEach(el=>{
      const name=el.dataset.name||'';
      if(q){el.style.display=name.toLowerCase().includes(q)?'':'none';if(name.toLowerCase().includes(q)&&el.closest('.ft-children')){let p=el.closest('.ft-children');while(p){p.style.display='block';if(p.parentElement)p.parentElement.classList.add('open');p=p.parentElement?p.parentElement.closest('.ft-children'):null}}}
      else{el.style.display='';document.querySelectorAll('.ft-children').forEach(c=>c.style.display='none');document.querySelectorAll('.ft-folder').forEach(f=>f.classList.remove('open'))}
    });
  };
}

function renderNode(node){
  if(node.children){
    return`<div class="ft-folder" data-name="${node.name}" onclick="event.stopPropagation();this.classList.toggle('open')"><span class="ft-arrow">â–¶</span> ğŸ“ ${node.name}<div class="ft-children">${node.children.map(c=>renderNode(c)).join('')}</div></div>`;
  }
  return`<div class="ft-file" data-name="${node.name}" onclick="event.stopPropagation();openFile('${node.name}')">ğŸ“„ ${node.name}<span class="ft-size">${node.size||''}</span></div>`;
}

function openFile(name){
  document.getElementById('slideTitle').textContent=name;
  document.getElementById('slideBody').textContent='Dateiinhalt wird geladen...';
  document.getElementById('slidePanel').classList.add('open');
}

window.onhashchange=()=>{const h=location.hash.replace('#','');if(DATA&&DATA.agents.find(a=>a.id===h))selectAgent(h)};
document.addEventListener('click',e=>{const p=document.getElementById('slidePanel');if(p.classList.contains('open')&&!p.contains(e.target)&&!e.target.classList.contains('ft-file'))p.classList.remove('open')});
init();
</script>
</body>
</html>
